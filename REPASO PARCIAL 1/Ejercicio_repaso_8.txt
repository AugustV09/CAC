      PIO EQU 30H ; REGISTRO PA DEL PIO
      EOI EQU 20H 
      TIMER EQU 10H  ; REGISTRO CONT DEL TIMER

      ORG 40
      DW GESTOR_TIMER

      ORG 3000H
GESTOR_TIMER:
      PUSH AX
      MOV BX,OFFSET TIME
      MOV AL,1
      INT 7
      DEC BYTE PTR[BX]
      DEC CL
      JNS FIN_TIMER
      MOV DL,0  ; CAMBIO LA FLAG UNA VEZ QUE SE CUMPLAN LOS 9 SEGUNDOS
      CLI
FIN_TIMER:
      MOV AL,0
      OUT TIMER,AL  ; REINICIO DE TIMER
      MOV AL,20H
      OUT EOI,AL
      POP AX
      IRET
      
CONFIGURAR_PIO:
      PUSH AX
      MOV AL, 0FFH  ; CONFIGURA PA COMO ENTRADA (CA = 11111111)
      OUT PIO+2,AL
      MOV AL,0  ; CONFIGURO PB COMO SALIDA (CB = 0)
      OUT PIO+3,AL
      POP AX
      RET

CONFIGURAR_TIMER:
      PUSH AX
      MOV AL, 11111101b  ; ENMASCARO TODO MENOS EL TIMER
      OUT EOI+1,AL
      MOV AL,10  ; NUMERO DE VECTOR DEL GESTOR DEL TIMER
      OUT EOI+5,AL
      MOV AL,1  ; CONDICION DE CORTE EN EL COMP
      OUT TIMER+1,AL
      MOV AL,0
      OUT TIMER,AL
      POP AX
      RET

INFORMAR:
      PUSH AX
      PUSH BX
      CMP DH,AH
      JNZ PERDIO
      MOV BX,OFFSET MSJ
      MOV AL,OFFSET MSJ2 - OFFSET MSJ
      CLI
      MOV DL,0
      INT 7  ; IMPRIMO "GANASTE"
      JMP FIN_INFORMAR

PERDIO:
      XOR DH,AH
      NOT DH    ; EL XNOR PERMITE COMPROBAR SI UNA CADENA DE BITS TIENE ALGO EN COMUN CON LA OTRA
      
      JNZ FIN_INFORMAR   ; CHEQUEO SI LAS DOS CADENAS SON COMPLETAMENTE DIFERENTES
      MOV BX,OFFSET MSJ2
      MOV AL,OFFSET SEC - OFFSET MSJ2
      INT 7  ; IMPRIMO "PERDISTE"
FIN_INFORMAR:
      POP BX
      POP AX
      RET

      ORG 1000H
MSJ   DB  "GANASTE",10    ;LF = 10
MSJ2  DB  "PERDISTE",10   ;LF = 10
SEC   DB 11111111b
TIME  DB  '9'

  
      ORG 2000H
      MOV DL,1  ; FLAG QUE CONTROLA EL FIN DEL JUEGO
      MOV AH,SEC  ; AH CONTIENE LA CADENA SECRETA DE BITS
      MOV CL,9
      CALL CONFIGURAR_PIO
      CALL CONFIGURAR_TIMER
      
; PREGUNTAS: ¿El mensaje de "PERDISTE" o "GANASTE" debe darse despues de cada intento?
            ;¿Indica "PERDISTE" siempre que las cadenas de bits son completamente diferentes? Si es asi, ¿Que indico cuando el jugador se equivoca pero no completamente?
             

JUEGO: 
      IN AL,PIO
      MOV DH,AL

      XOR AL,AH
      NOT AL    ; XNOR PERMITE QUE ENCIENDA LAS LUCES QUE CORRESPONDIENTES CON LAS LLAVES SECRETAS
      
      OUT PIO+1,AL  ; REFLEJO EN LAS LUCES SI EL JUGADOR ADIVINO ALGUNA LLAVE
      
      CALL INFORMAR
      CMP DL,0
      JNZ JUEGO
      
      HLT
      END

      