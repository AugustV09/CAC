      HANDSHAKE EQU 40H ; REGISTRO DE DATOS DE LA HANDSHAKE
      EOI EQU 20H 

      ORG 40
      DW GESTOR_F10

      ORG 3000H
GESTOR_F10:
      PUSH AX
      MOV DL,0  ; CAMBIO DL ("FLAG") PARA CONTINUAR CON EL PROGRAMA
      MOV AL,20H
      OUT EOI,AL
      POP AX
      IRET
      
LEER_DIGITO:
      PUSH BX
      PUSH AX
      PUSH DX
      PUSH CX
      MOV DX,OFFSET MSJ  ; ME GUARDO LA DIRECCION DE MSJ EN DX
      MOV AL,OFFSET NUM - OFFSET MSJ  ; ME GUARDO EN AL LA LONGITUD DE MSJ
      MOV CX,OFFSET NUM  ; ME GUARDO EN CX LA DIRECCION DE NUM (NUMERO A INGRESAR)
      MOV AH,'9'  ; ME GUARDO EN AH '9' PARA EL ULTIMO CMP (ASI EVITO TENER QUE PONER OTRA COMPARACION)
ESPERA_INGRESO:
      MOV BX,DX
      INT 7
      MOV BX,CX
      INT 6
      CMP BYTE PTR[BX],'0'
      JS ESPERA_INGRESO
      CMP AH,[BX]
      JS ESPERA_INGRESO
      POP CX
      POP DX
      POP AX
      POP BX
      RET
      
DESCENDER:
      PUSH BX
      MOV BX,SP
      PUSH AX
      ADD BX,4
      MOV BX,[BX]  ; ME GUARDO AL DIRRECION DE NUM EN BX
      MOV BL,[BX]  ; ME GUARDO NUM EN BL
      SUB AH,'0'   ; DEJO AH EN EL NUMERO DECIMAL
IMPRESION:
      IN AL,HANDSHAKE+1
      AND AL,1
      JNZ IMPRESION    ; REVISO QUE BUSY = 0
      MOV AL,BL
      OUT HANDSHAKE,AL
      DEC BL
      DEC AH
      JNS IMPRESION
      POP AX
      POP BX
      RET
      

      ORG 1000H
MSJ   DB  "INGRESE UN NUMERO DEL 1 AL 9:",10    ;LF = 10
NUM   DB ?
  
      ORG 2000H
      CLI  ; INHABILITO LAS INTERRUPCIONES
      MOV DL,1
      MOV AL,11111110b  ; ENMASCARO TOD MENOS EL F10
      OUT EOI+1,AL
      MOV AL, 10  ; NUMERO DE VECTOR DEL GESTOR DEL F10
      OUT EOI+4,AL
      CALL LEER_DIGITO
      STI  ;HABILITO LAS INTERRUPCIONES

LOOP:
      CMP DL,0
      JNZ LOOP
      CLI    ; INHABILITO LAS INTERRUPCIONES

      MOV AH,NUM
      MOV BX,OFFSET NUM
      PUSH BX
      CALL DESCENDER
      POP BX
      HLT
      END