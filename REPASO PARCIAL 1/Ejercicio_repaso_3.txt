    IMR EQU 21H
    PIO EQU 30H ; POSICION DEL REGISTRO PA DE LA PIO

    ORG 40
    DW  GESTOR_F10

    ORG 3000H
GESTOR_F10:
    PUSH AX
    MOV DL,0  ; CAMBIO A DL PARA QUE EL PROGRAMA SIGUE DESPUES DE TOCAR F10
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET

IMPRIMIR:
    PUSH BX
    MOV BX,SP
    PUSH AX
    PUSH CX
    PUSH DX
    CALL CONFIGURAR_IMPRESORA
    ADD BX,4
    MOV BX,[BX]  ;DIRECCION DE MSJ2, LA CUAL RECIBO POR LA PILA
    MOV AH,10  ;LONGITUD DE MSJ2
CONTINUAR_IMPRESION:
    MOV AL,[BX]  ; ME GUARDO EN AL EL PRIMER CARACTER DE MSJ2
    OUT PIO+1,AL  ; CARGO EL CONTENIDO DE AL EN PB (DATOS PARA LA IMPRESORA)
BUSY:
    IN AL,PIO  
    AND AL,1  ;REVISO QUE BUSY NO ESTE EN 0
    JNZ BUSY
    MOV AL,0  ; SEÑAL DESCENDENTE
    OUT PIO,AL
    MOV AL,0FFH  ;SEÑAL ASCENDENTE
    OUT PIO,AL
    INC BX
    DEC AH
    JNZ CONTINUAR_IMPRESION
    POP DX
    POP CX
    POP AX
    POP BX
    RET

CONFIGURAR_IMPRESORA:
    PUSH AX
    PUSH BX
    PUSH CX
    PUSH DX
    MOV AL,11111101b  
    OUT PIO+2,AL  ; CONFIGURACION DE CA
    MOV AL,0
    OUT PIO+3,AL  ; CONFIGURACION DE CB
    POP DX
    POP CX
    POP BX
    POP AX
    RET


    ORG 1000H
MSJ1 DB "PRESIONE F10 PARA COMENZAR"
MSJ2 DB ?

    ORG 2000H
    CLI  ; INHABILITO TODAS LAS INTERRUPCIONES
    MOV AL,11111110b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS F10
    OUT IMR,AL
    MOV AL,10  ; NUMERO DE VECTOR DEL GESTOR DEL F10
    OUT IMR+3,AL
    MOV DL,1  ; FLAG PARA CUANDO SE TOQUE F10
    MOV BX,OFFSET MSJ1  ; DIRECCION DE MSJ1
    MOV AL,OFFSET MSJ2 - OFFSET MSJ1  ; LONGITUD DE MSJ1
    STI  ; HABILITO TODAS LAS INTERRUPCIONES
    INT 7
    
LOOP:
    CMP DL,0  ; CONDICION QUE SE DESCATIVARA CUANDO SE TOQUE F10
    JNZ LOOP
    
    CLI  ;INHABILITO TODAS LAS INTERRUPCIONES
    
    MOV BX,OFFSET MSJ2  ; DIRECCION DE MSJ2
    MOV AL,10  ;LONGITUD QUE DEBE TENER MSJ2
INGRESAR:
    INT 6
    INC BX
    DEC AL
    JNZ INGRESAR
    MOV BX,OFFSET MSJ2
    PUSH BX  ; UTILIZO LA PILA PARA PASAR MSJ2 (POR REFERENCIA)
    CALL IMPRIMIR
    POP BX
    HLT
    END