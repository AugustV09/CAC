4_a)
    IMR EQU 21H

    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10 ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    PUSH AX
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    POP AX
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111110b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+3,AL
    MOV BX,OFFSET MSJ
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    JMP LAZO
    HLT
    END

b)
    IMR EQU 21H

    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10  ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    PUSH AX
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    DEC DL
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    POP AX
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111110b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+3,AL
    MOV DL,5  ;CONTROLA QUE EL PROGRAMA SE HAGA 5 VECES
    MOV BX,OFFSET MSJ
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT
    END

5_a)
    IMR EQU 21H
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    
    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10  ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    MOV AL,0
    OUT TIMER,AL
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111101b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+4,AL
    MOV BX, OFFSET MSJ ;ME GUARDO LA DIRECCION DEL VECTOR DE CARACTERES (MSJ + LF)
    MOV AL,2
    OUT TIMER+1,AL  ; PONGO EL REGISTRO COMP DEL TIMER EN 2
    MOV AL,0
    OUT TIMER,AL  ; PONGO EL CONT DEL TIMER EN 0
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    JMP LAZO
    HLT
    END

b)
    IMR EQU 21H
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    
    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10  ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    MOV AL,0
    OUT TIMER,AL
    DEC DL
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111101b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+4,AL
    MOV BX, OFFSET MSJ ;ME GUARDO LA DIRECCION DEL VECTOR DE CARACTERES (MSJ + LF)
    MOV DL,5  ; HACE QUE EL PROGRAMA DURE 10 SEGUNDOS (SE EJECUTE EL GESTOR CADA 2 SEG POR 10 SEG)
    MOV AL,2
    OUT TIMER+1,AL  ; PONGO EL REGISTRO COMP DEL TIMER EN 2
    MOV AL,0
    OUT TIMER,AL  ; PONGO EL CONT DEL TIMER EN 0
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT
    END

c)
    IMR EQU 21H
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    
    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10  ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    DEC DL
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111101b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+4,AL
    MOV BX, OFFSET MSJ ;ME GUARDO LA DIRECCION DEL VECTOR DE CARACTERES (MSJ + LF)
    MOV DL,1  ; SIRVE PARA QUE EL GESTOR DEL TIMER SE EJECUTE UNA VEZ (DESPUES DE 10 SEGUNDOS) Y DESPUES ACABE EL PROGRAMA
    MOV AL,10  
    OUT TIMER+1,AL  ; PONGO EL REGISTRO COMP DEL TIMER EN 10
    MOV AL,0
    OUT TIMER,AL  ; PONGO EL CONT DEL TIMER EN 0
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT
    END

d)
    IMR EQU 21H
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    
    ORG 40
    DW GESTOR
    
    ORG 1000H
MSJ DB "VAMOS LAS INTERRUPCIONES!",10  ;LF
FIN DB ?

    ORG 3000H
GESTOR:
    MOV AL, OFFSET FIN - OFFSET MSJ
    INT 7  ;IMPRIMO EL MENSAJE
    IN AL,TIMER+1  ; ME GUARDO EN AL EL VALOR DEL REGISTRO COMP DEL TIMER
    INC AL  ;INCREMENTO EL VALOR QUE ESTABA EN EL REGISTRO COMP DEL TIMER
    OUT TIMER+1,AL    ;GUARDO EN EL REGISTRO COMP SU VALOR PREVIO PERO INCREMENTADO
    MOV AL,0
    OUT TIMER,AL
    INC DL
    MOV AL,20H
    OUT IMR-1,AL  ;PONGO 20H EN EOI
    IRET

    ORG 2000H
    CLI    ;INHABILITO LAS INTERRUPCIONES
    MOV AL,11111101b  ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS LA DE F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+4,AL
    MOV BX, OFFSET MSJ ;ME GUARDO LA DIRECCION DEL VECTOR DE CARACTERES (MSJ + LF)
    MOV DL,1  ; SIRVE PARA IRLA AUMENTANDO EN EL GESTOR DEL TIMER E IR CONTROLANDO LA VUELTA EN LA QUE ESTOY 
    MOV AL,1
    OUT TIMER+1,AL  ; PONGO EL REGISTRO COMP DEL TIMER EN 1
    MOV AL,0
    OUT TIMER,AL  ; PONGO EL CONT DEL TIMER EN 0
    STI    ;HABILITO LAS INTERRUPCIONES

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT
    END
    
6_a)
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    IMR   EQU 21H
    
    ORG 40
    DW GESTOR_F10
    
    ORG 44
    DW GESTOR_TIMER

    ORG 3000H
GESTOR_F10:    ; ESTE GESTOR DESENMASCARA AL TIMER, LE ESTABLECE UN NUMERO DE VECTOR Y LO INICIALIZA
    MOV AL,11111100b
    OUT IMR,AL
    MOV AL,11
    OUT IMR+4,AL
    MOV AL,1
    OUT TIMER+1,AL
    MOV AL,0
    OUT TIMER,AL
    MOV AL,20H
    OUT IMR-1,AL
    IRET

GESTOR_TIMER:
    MOV AL,1
    INT 7
    DEC BYTE PTR[BX]
    DEC DL
    MOV AL,0
    OUT TIMER,AL
    MOV AL,20H
    OUT IMR-1,AL
    IRET
    
    ORG 1000H
NUM DB ?
    
    ORG 2000H
    CLI
    MOV AL, 11111110b  ; ENMASCARO TODO MENOS EL F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+3,AL  ; COLOCO EL NUMERO DE VECTOR 10 EN INT0 (24H)
    MOV BX,OFFSET NUM
    INT 6
    MOV DL,NUM  ; UTILIZO NUM PARA CONTROLAR LAZO 
    SUB DL,'0'  ; RESTO '0' PARA QUE DL TENGA EL NUMERO DECIMAL
    STI
LAZO:
    CMP DL,0
    JNS LAZO
    HLT 
    END

b)
    TIMER EQU 10H  ;POSICION AL REGISTRO CONT DE TIMER
    IMR   EQU 21H
    
    ORG 40
    DW GESTOR_F10
    
    ORG 44
    DW GESTOR_TIMER

    ORG 3000H
GESTOR_F10:    ; ESTE GESTOR DESENMASCARA O ENMASCARA AL TIMER SEGUN CORRESPONDA Y LO INICIALIZA SEGUN CORRESPONDA
    PUSH AX
    IN AL,IMR
    XOR AL,00000010b  ;MASCARA PARA INVERTIR LOS BITS COMO NECESITO
    OUT IMR,AL
    CMP AL,11111100b  ;REVISO SI EN ESTA VUELTA SE DESENMASCARO O NO AL TIMER PARA INICIALIZARLO O NO, RESPECTIVAMENTE
    JNZ FIN_GESTOR_F10
    MOV AL,11
    OUT IMR+4,AL
    MOV AL,1
    OUT TIMER+1,AL
    MOV AL,0
    OUT TIMER,AL
FIN_GESTOR_F10:
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET

GESTOR_TIMER:
    PUSH AX
    MOV AL,1
    INT 7
    DEC BYTE PTR[BX]
    DEC DL
    JNS SEGUIR
    MOV [BX],DH   ;COPIO '9' EN LA DIRECCION A LA QUE PUNTA BX
    MOV DL,DH
    SUB DL,'0'  ;HAGO QUE DL QUEDE EN 9 DECIMAL
    MOV AL,11111110b  ; ENMASCARO EL TIMER
    OUT IMR,AL
    JMP FIN_GESTOR_TIMER
SEGUIR:
    MOV AL,0
    OUT TIMER,AL
FIN_GESTOR_TIMER:
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET
    
    ORG 1000H
NUM DB '9'
    
    ORG 2000H
    CLI
    MOV AL, 11111110b  ; ENMASCARO TODO MENOS EL F10
    OUT IMR,AL
    MOV AL,10
    OUT IMR+3,AL  ; COLOCO EL NUMERO DE VECTOR 10 EN INT0 (24H)
    MOV BX,OFFSET NUM
    MOV DL,NUM
    SUB DL,'0'  ;HAGO QUE EN DL ESTE EL NUMERO 9 DECIMAL
    MOV DH,NUM  ;HAGO QUE EN DH ESTE EL CARACTER '9'
    STI
LAZO:
    JMP LAZO
    HLT 
    END
    
7_a)
    IMR   EQU 21H
HANDSHAKE EQU 40H ; POSICION DEL REGISTRO DE DATOS DEL HANDSHAKE
    
    ORG 40
    DW GESTOR_HANDSHAKE


    ORG 3000H
GESTOR_HANDSHAKE:    ; ESTE GESTOR ES EL DEL HANDSHAKE
    PUSH AX
    MOV AL,[BX]    ; ME QUEDO CON EL CHAR RESPECTIVO DE MSJ
    INC BX
    DEC DH
    JS SEGUIR    ; SI NO LE ENTRA NADA AL REGISTRO DE DATOS, LA IMPRESORA NO IMPRIME Y NO ENTRA MAS A LA INTERRUPCION
    OUT HANDSHAKE,AL
SEGUIR:
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET

    ORG 1000H
MSJ DB "UNIVERSIDAD NACIONAL DE LA PLATA"
FIN DB ?
    
    ORG 2000H
    CLI
    MOV AL,11111011b  ; ENMASCARO TODO MENOS EL HANDSHAKE
    OUT IMR,AL
    MOV AL,10
    OUT IMR+5,AL  ; COLOCO EL NUMERO DE VECTOR 10 EN INT2 (26H)
    IN AL,HANDSHAKE+1
    OR AL,10000000b    ;ESTA MASCARA ESTA PARA NO PISAR LOS BITS DEL REGISTRO DE ESTADO DEL HANDSHAKE
    OUT HANDSHAKE+1,AL
    MOV BX,OFFSET MSJ  ;DIRECCION DE MENSAJE
    MOV DH,OFFSET FIN - OFFSET MSJ  ;LONGITUD DE MENSAJE
    STI
LAZO:
    CMP DH,0
    JNZ LAZO
    HLT 
    END

b)
    IMR   EQU 21H
HANDSHAKE EQU 40H ; POSICION DEL REGISTRO DE DATOS DEL HANDSHAKE

    ORG 40
    DW  GESTOR_HANDSHAKE

    ORG 3000H
GESTOR_HANDSHAKE:
    MOV AL,[BX]  ;PONGO EN AL LA LETRA RESPECTIVA DE AL
    DEC DL
    JS FINAL
    OUT HANDSHAKE,AL  ; CARGO EN EL REGISTRO DATOS EL CARACTER RESPECTIVO
    INC BX
FINAL:
    MOV AL,20H
    OUT IMR-1,AL  ;COLOCO 20H EN EOI
    IRET


    ORG 1000H
PAL DB ?

    ORG 2000H
    CLI
    MOV AL,11111011b  ; ENMASCARO TODO MENOS EL HANDSHAKE
    OUT IMR,AL
    MOV AL,10  ; NUMERO DE VECTOR DEL GESTOR DEL HANDSHAKE
    OUT IMR+5,AL
    IN AL,HANDSHAKE+1
    OR AL,10000000b  ; MASCARA PARA NO ALTERAR LOS OTROS BITS DE LA IMPRESORA
    OUT HANDSHAKE+1,AL  ; ACTIVO LAS INTERRUPCIONES DEL HANDSHAKE
    MOV BX,OFFSET PAL
    MOV CX,BX  ;SALVO EL CONTENIDO DE BX
    MOV AH,10
    MOV DL,10
LOOP:
    INT 6
    INC BX
    DEC AH
    JNZ LOOP
    MOV BX,CX  ; RECUPERO LA DIRECCION DE PAL
    STI

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT 
    END

c)
    IMR   EQU 21H
HANDSHAKE EQU 40H ; POSICION DEL REGISTRO DE DATOS DEL HANDSHAKE

    ORG 40
    DW  GESTOR_HANDSHAKE

    ORG 44
    DW  GESTOR_F10

    

    ORG 3000H
GESTOR_HANDSHAKE:
    MOV AL,[BX]  ;PONGO EN AL LA LETRA RESPECTIVA DE AL
    DEC DL
    JS FINAL
    OUT HANDSHAKE,AL  ; CARGO EN EL REGISTRO DATOS EL CARACTER RESPECTIVO
    INC BX
FINAL:
    MOV AL,20H
    OUT IMR-1,AL  ;COLOCO 20H EN EOI
    IRET

GESTOR_F10:
    PUSH AX
    IN AL,HANDSHAKE+1  ; ME TRAIGO EL CONTENIDO DEL REGISTRO DE ESTADO DEL HANDSHAKE
    AND AL,01111111b  ; CON ESTA MASCARA DEJO TODO COMO ESTABA MENOS EL BIT DE INTERRUPCIONES
    OUT HANDSHAKE+1,AL
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET

    ORG 1000H
PAL DB ?

    ORG 2000H
    CLI
    MOV AL,11111010b  ; ENMASCARO TODO MENOS EL HANDSHAKE Y EL F10
    OUT IMR,AL
    MOV AL,10  ; NUMERO DE VECTOR DEL GESTOR DEL HANDSHAKE
    OUT IMR+5,AL
    MOV AL,11  ; NUMERO DE VECTOR DEL GESTOR DEL F10
    OUT IMR+3,AL
    IN AL,HANDSHAKE+1
    OR AL,10000000b  ; MASCARA PARA NO ALTERAR LOS OTROS BITS DE LA IMPRESORA
    OUT HANDSHAKE+1,AL  ; ACTIVO LAS INTERRUPCIONES DEL HANDSHAKE
    MOV BX,OFFSET PAL
    MOV CX,BX  ;SALVO EL CONTENIDO DE BX
    MOV AH,10
    MOV DL,10
LOOP:
    INT 6
    INC BX
    DEC AH
    JNZ LOOP
    MOV BX,CX  ; RECUPERO LA DIRECCION DE PAL
    STI

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT 
    END

VERSION PARA PAUSAR E INICIAR LA IMPRESION:
(RE-ACTIVAR EL BIT DE INTERRUPCIONES DEL HANDSHAKE ES SUFICIENTE PARA QUE LA IMPRESION INICIE DE NUEVO)

    IMR   EQU 21H
HANDSHAKE EQU 40H ; POSICION DEL REGISTRO DE DATOS DEL HANDSHAKE

    ORG 40
    DW  GESTOR_HANDSHAKE

    ORG 44
    DW  GESTOR_F10

    

    ORG 3000H
GESTOR_HANDSHAKE:
    MOV AL,[BX]  ;PONGO EN AL LA LETRA RESPECTIVA DE AL
    DEC DL
    JS FINAL
    OUT HANDSHAKE,AL  ; CARGO EN EL REGISTRO DATOS EL CARACTER RESPECTIVO
    INC BX
FINAL:
    MOV AL,20H
    OUT IMR-1,AL  ;COLOCO 20H EN EOI
    IRET

GESTOR_F10:
    PUSH AX
    IN AL,HANDSHAKE+1  ; ME TRAIGO EL CONTENIDO DEL REGISTRO DE ESTADO DEL HANDSHAKE
    XOR AL,10000000b  ; CON ESTA MASCARA DEJO TODO COMO ESTABA PERO INVIERTO EL BIT DE INTERRUPCIONES
    ; RE-ACTIVAR EL BIT DE INTERRUPCIONES DEL HANDSHAKE ES SUFICIENTE PARA QUE LA IMPRESION INICIE DE NUEVO
    
    OUT HANDSHAKE+1,AL
    MOV AL,20H
    OUT IMR-1,AL
    POP AX
    IRET

    ORG 1000H
PAL DB ?

    ORG 2000H
    CLI
    MOV AL,11111010b  ; ENMASCARO TODO MENOS EL HANDSHAKE Y EL F10
    OUT IMR,AL
    MOV AL,10  ; NUMERO DE VECTOR DEL GESTOR DEL HANDSHAKE
    OUT IMR+5,AL
    MOV AL,11  ; NUMERO DE VECTOR DEL GESTOR DEL F10
    OUT IMR+3,AL
    IN AL,HANDSHAKE+1
    OR AL,10000000b  ; MASCARA PARA NO ALTERAR LOS OTROS BITS DE LA IMPRESORA
    OUT HANDSHAKE+1,AL  ; ACTIVO LAS INTERRUPCIONES DEL HANDSHAKE
    MOV BX,OFFSET PAL
    MOV CX,BX  ;SALVO EL CONTENIDO DE BX
    MOV AH,10
    MOV DL,10
LOOP:
    INT 6
    INC BX
    DEC AH
    JNZ LOOP
    MOV BX,CX  ; RECUPERO LA DIRECCION DE PAL
    STI

LAZO:
    CMP DL,0
    JNZ LAZO
    HLT 
    END
    
